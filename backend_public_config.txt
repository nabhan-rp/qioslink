
<?php
// FILE: api/get_public_config.php
// INSTRUKSI: Upload file ini ke folder /api/

require 'db_connect.php';

// Header JSON
header('Content-Type: application/json');

// Ambil Config milik SUPERADMIN (ID 1)
$sql = "SELECT merchant_config FROM users WHERE id = 1";
$result = $conn->query($sql);

if ($result && $result->num_rows > 0) {
    $row = $result->fetch_assoc();
    $fullConfig = json_decode($row['merchant_config'], true);
    
    // PENTING: Hanya return data yang aman untuk publik!
    // Jangan return API Key, SMTP Pass, dll.
    $authConfig = isset($fullConfig['auth']) ? $fullConfig['auth'] : [];
    
    // Filter hanya bagian Social Login yang dibutuhkan Frontend
    $safeConfig = [
        'loginMethod' => $authConfig['loginMethod'] ?? 'standard',
        'socialLogin' => [
            'google' => $authConfig['socialLogin']['google'] ?? false,
            'googleClientId' => $authConfig['socialLogin']['googleClientId'] ?? '',
            
            'facebook' => $authConfig['socialLogin']['facebook'] ?? false,
            'facebookAppId' => $authConfig['socialLogin']['facebookAppId'] ?? '',
            
            'github' => $authConfig['socialLogin']['github'] ?? false,
            'githubClientId' => $authConfig['socialLogin']['githubClientId'] ?? ''
        ]
    ];

    echo json_encode([
        'success' => true,
        'config' => $safeConfig
    ]);
} else {
    echo json_encode(['success' => false, 'message' => 'Config not found']);
}
?>
